create schema logging;
create extension pg_logging schema logging;
set log_statement=none;
set pg_logging.buffer_position = 0;
ERROR:  this parameter could not be changed
set pg_logging.buffer_size = 2000;
ERROR:  buffer size cannot be increased
set pg_logging.buffer_size = 1;
show pg_logging.buffer_position;
 pg_logging.buffer_position 
----------------------------
 endpos: 0, readpos: 0
(1 row)

select logging.flush_log();
 flush_log 
-----------
 
(1 row)

select * from logging.pg_log;
 level | errno | message | detail | hint 
-------+-------+---------+--------+------
       |       |         |        | 
(1 row)

select 1/0;
ERROR:  division by zero
show pg_logging.buffer_position;
 pg_logging.buffer_position 
----------------------------
 endpos: 48, readpos: 0
(1 row)

select 'aaaaa'::int;
ERROR:  invalid input syntax for integer: "aaaaa"
LINE 1: select 'aaaaa'::int;
               ^
show pg_logging.buffer_position;
 pg_logging.buffer_position 
----------------------------
 endpos: 120, readpos: 0
(1 row)

select * from logging.get_log(true);
 level | errno |                  message                  | detail | hint | position 
-------+-------+-------------------------------------------+--------+------+----------
    20 |     0 | division by zero                          |        |      |        0
    20 |     0 | invalid input syntax for integer: "aaaaa" |        |      |       48
(2 rows)

select repeat('aaaaaaaaa', 20)::int;
ERROR:  invalid input syntax for integer: "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"
select repeat('aaaaaaaaa', 20)::int;
ERROR:  invalid input syntax for integer: "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"
select repeat('aaaaaaaaa', 20)::int;
ERROR:  invalid input syntax for integer: "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"
select repeat('aaaaaaaaa', 20)::int;
ERROR:  invalid input syntax for integer: "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"
show pg_logging.buffer_position;
 pg_logging.buffer_position 
----------------------------
 endpos: 88, readpos: 120
(1 row)

select * from logging.get_log(true);
 level | errno |                                                                                                         message                                                                                                          | detail | hint | position 
-------+-------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------+------+----------
    20 |     0 | invalid input syntax for integer: "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa" |        |      |      120
    20 |     0 | invalid input syntax for integer: "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa" |        |      |      368
    20 |     0 | invalid input syntax for integer: "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa" |        |      |      616
    20 |     0 | invalid input syntax for integer: "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa" |        |      |      864
(4 rows)

select logging.test_ereport('error', 'one', 'two', 'three');
ERROR:  one
DETAIL:  two
HINT:  three
select * from logging.get_log(true);
 level | errno | message | detail | hint  | position 
-------+-------+---------+--------+-------+----------
    20 |     0 | one     | two    | three |       88
(1 row)

drop extension pg_logging;
